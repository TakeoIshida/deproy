{"filter":false,"title":"BookController.php","tooltip":"/cms/app/Http/Controllers/BookController.php","undoManager":{"mark":39,"position":39,"stack":[[{"start":{"row":84,"column":1},"end":{"row":85,"column":0},"action":"remove","lines":["",""],"id":2}],[{"start":{"row":84,"column":0},"end":{"row":84,"column":1},"action":"remove","lines":["}"],"id":3}],[{"start":{"row":0,"column":0},"end":{"row":84,"column":0},"action":"remove","lines":["<?php","","namespace App\\Http\\Controllers;","","use App\\Models\\Book;","use Illuminate\\Http\\Request;","","class BookController extends Controller","{","    /**","     * Display a listing of the resource.","     *","     * @return \\Illuminate\\Http\\Response","     */","    public function index()","    {","        //","    }","","    /**","     * Show the form for creating a new resource.","     *","     * @return \\Illuminate\\Http\\Response","     */","    public function create()","    {","        //","    }","","    /**","     * Store a newly created resource in storage.","     *","     * @param  \\Illuminate\\Http\\Request  $request","     * @return \\Illuminate\\Http\\Response","     */","    public function store(Request $request)","    {","        //","    }","","    /**","     * Display the specified resource.","     *","     * @param  \\App\\Models\\Book  $book","     * @return \\Illuminate\\Http\\Response","     */","    public function show(Book $book)","    {","        //","    }","","    /**","     * Show the form for editing the specified resource.","     *","     * @param  \\App\\Models\\Book  $book","     * @return \\Illuminate\\Http\\Response","     */","    public function edit(Book $book)","    {","        //","    }","","    /**","     * Update the specified resource in storage.","     *","     * @param  \\Illuminate\\Http\\Request  $request","     * @param  \\App\\Models\\Book  $book","     * @return \\Illuminate\\Http\\Response","     */","    public function update(Request $request, Book $book)","    {","        //","    }","","    /**","     * Remove the specified resource from storage.","     *","     * @param  \\App\\Models\\Book  $book","     * @return \\Illuminate\\Http\\Response","     */","    public function destroy(Book $book)","    {","        //","    }",""],"id":4}],[{"start":{"row":0,"column":0},"end":{"row":131,"column":1},"action":"insert","lines":["<?php","","namespace App\\Http\\Controllers;","","use Illuminate\\Http\\Request;","use App\\Models\\Book;","use Validator;","","class BookController extends Controller","{","    /**","     * Display a listing of the resource.","     *","     * @return \\Illuminate\\Http\\Response","     */","    public function index()","    {","        $books = Book::orderBy('created_at', 'asc')->get();","        return view('books', ['books' => $books]);","    }","","    /**","     * Show the form for creating a new resource.","     *","     * @return \\Illuminate\\Http\\Response","     */","    public function create()","    {","        //","    }","","    /**","     * Store a newly created resource in storage.","     *","     * @param  \\Illuminate\\Http\\Request  $request","     * @return \\Illuminate\\Http\\Response","     */","    public function store(Request $request)","    {","\t\t// バリデーション","\t    $validator = Validator::make($request->all(), [","\t        'item_name'   => 'required | min:3 | max:255',","\t        'item_number' => 'required | min:1 | max:3',","\t        'item_amount' => 'required | max:6',","\t        'published'   => 'required',","\t    ]);","","\t\t\t// バリデーション:エラー時の処理","\t    if ($validator->fails()) {","\t        return redirect('/')","\t            ->withInput()","\t            ->withErrors($validator);","\t    }","\t\t\t","\t\t// 登録処理","        $book = new Book;","        $book->item_name =    $request->item_name;","        $book->item_number =  $request->item_number;","        $book->item_amount =  $request->item_amount;","        $book->published =    $request->published;","        $book->save();","        return redirect('/');","    }","","    /**","     * Display the specified resource.","     *","     * @param  int  $id","     * @return \\Illuminate\\Http\\Response","     */","    public function show($id)","    {","        //","    }","","    /**","     * Show the form for editing the specified resource.","     *","     * @param  int  $id","     * @return \\Illuminate\\Http\\Response","     */","    public function edit(Book $book)","    {","        return view('booksedit', ['book' => $book]);","    }","","    /**","     * Update the specified resource in storage.","     *","     * @param  \\Illuminate\\Http\\Request  $request","     * @param  int  $id","     * @return \\Illuminate\\Http\\Response","     */","    public function update(Request $request)","    {","\t\t// バリデーション","\t\t$validator = Validator::make($request->all(), [","\t\t    'id' => 'required', // storeに対しての追加分","\t\t    'item_name' => 'required|min:3|max:255',","\t\t    'item_number' => 'required|min:1|max:3',","\t\t    'item_amount' => 'required|max:6',","\t\t    'published' => 'required',","\t\t]);","","\t\t// バリデーション:エラー","\t\tif ($validator->fails()) {","\t\t    return redirect('/booksedit/'.$request->id)","\t\t        ->withInput()","\t\t        ->withErrors($validator);","\t\t}","","        $book = Book::find($request->id);","        $book->item_name =    $request->item_name;","        $book->item_number =  $request->item_number;","        $book->item_amount =  $request->item_amount;","        $book->published =    $request->published;","        $book->save(); ","        return redirect('/');","    }","","    /**","     * Remove the specified resource from storage.","     *","     * @param  int  $id","     * @return \\Illuminate\\Http\\Response","     */","    public function destroy(Book $book)","    {","        $book->delete();","        return redirect('/');","    }","}"],"id":5}],[{"start":{"row":42,"column":8},"end":{"row":42,"column":10},"action":"insert","lines":["//"],"id":6},{"start":{"row":43,"column":8},"end":{"row":43,"column":10},"action":"insert","lines":["//"]},{"start":{"row":44,"column":8},"end":{"row":44,"column":10},"action":"insert","lines":["//"]}],[{"start":{"row":41,"column":18},"end":{"row":41,"column":19},"action":"remove","lines":["e"],"id":7},{"start":{"row":41,"column":17},"end":{"row":41,"column":18},"action":"remove","lines":["m"]},{"start":{"row":41,"column":16},"end":{"row":41,"column":17},"action":"remove","lines":["a"]},{"start":{"row":41,"column":15},"end":{"row":41,"column":16},"action":"remove","lines":["n"]}],[{"start":{"row":41,"column":15},"end":{"row":41,"column":16},"action":"insert","lines":["t"],"id":8},{"start":{"row":41,"column":16},"end":{"row":41,"column":17},"action":"insert","lines":["e"]},{"start":{"row":41,"column":17},"end":{"row":41,"column":18},"action":"insert","lines":["x"]},{"start":{"row":41,"column":18},"end":{"row":41,"column":19},"action":"insert","lines":["t"]}],[{"start":{"row":56,"column":23},"end":{"row":56,"column":24},"action":"remove","lines":["e"],"id":9},{"start":{"row":56,"column":22},"end":{"row":56,"column":23},"action":"remove","lines":["m"]},{"start":{"row":56,"column":21},"end":{"row":56,"column":22},"action":"remove","lines":["a"]},{"start":{"row":56,"column":20},"end":{"row":56,"column":21},"action":"remove","lines":["n"]}],[{"start":{"row":56,"column":20},"end":{"row":56,"column":21},"action":"insert","lines":["t"],"id":10},{"start":{"row":56,"column":21},"end":{"row":56,"column":22},"action":"insert","lines":["e"]},{"start":{"row":56,"column":22},"end":{"row":56,"column":23},"action":"insert","lines":["x"]},{"start":{"row":56,"column":23},"end":{"row":56,"column":24},"action":"insert","lines":["t"]}],[{"start":{"row":56,"column":48},"end":{"row":56,"column":49},"action":"remove","lines":["e"],"id":11},{"start":{"row":56,"column":47},"end":{"row":56,"column":48},"action":"remove","lines":["m"]},{"start":{"row":56,"column":46},"end":{"row":56,"column":47},"action":"remove","lines":["a"]},{"start":{"row":56,"column":45},"end":{"row":56,"column":46},"action":"remove","lines":["n"]}],[{"start":{"row":56,"column":45},"end":{"row":56,"column":46},"action":"insert","lines":["t"],"id":12},{"start":{"row":56,"column":46},"end":{"row":56,"column":47},"action":"insert","lines":["e"]},{"start":{"row":56,"column":47},"end":{"row":56,"column":48},"action":"insert","lines":["x"]},{"start":{"row":56,"column":48},"end":{"row":56,"column":49},"action":"insert","lines":["t"]}],[{"start":{"row":57,"column":8},"end":{"row":57,"column":11},"action":"insert","lines":["// "],"id":13},{"start":{"row":58,"column":8},"end":{"row":58,"column":11},"action":"insert","lines":["// "]},{"start":{"row":59,"column":8},"end":{"row":59,"column":11},"action":"insert","lines":["// "]}],[{"start":{"row":98,"column":15},"end":{"row":98,"column":16},"action":"remove","lines":["e"],"id":14},{"start":{"row":98,"column":14},"end":{"row":98,"column":15},"action":"remove","lines":["m"]},{"start":{"row":98,"column":13},"end":{"row":98,"column":14},"action":"remove","lines":["a"]},{"start":{"row":98,"column":12},"end":{"row":98,"column":13},"action":"remove","lines":["n"]}],[{"start":{"row":98,"column":12},"end":{"row":98,"column":13},"action":"insert","lines":["t"],"id":15},{"start":{"row":98,"column":13},"end":{"row":98,"column":14},"action":"insert","lines":["e"]},{"start":{"row":98,"column":14},"end":{"row":98,"column":15},"action":"insert","lines":["x"]},{"start":{"row":98,"column":15},"end":{"row":98,"column":16},"action":"insert","lines":["t"]}],[{"start":{"row":99,"column":4},"end":{"row":99,"column":6},"action":"insert","lines":["//"],"id":16},{"start":{"row":100,"column":4},"end":{"row":100,"column":6},"action":"insert","lines":["//"]},{"start":{"row":101,"column":4},"end":{"row":101,"column":6},"action":"insert","lines":["//"]}],[{"start":{"row":112,"column":23},"end":{"row":112,"column":24},"action":"remove","lines":["e"],"id":17},{"start":{"row":112,"column":22},"end":{"row":112,"column":23},"action":"remove","lines":["m"]},{"start":{"row":112,"column":21},"end":{"row":112,"column":22},"action":"remove","lines":["a"]},{"start":{"row":112,"column":20},"end":{"row":112,"column":21},"action":"remove","lines":["n"]}],[{"start":{"row":112,"column":20},"end":{"row":112,"column":21},"action":"insert","lines":["t"],"id":18},{"start":{"row":112,"column":21},"end":{"row":112,"column":22},"action":"insert","lines":["e"]},{"start":{"row":112,"column":22},"end":{"row":112,"column":23},"action":"insert","lines":["x"]},{"start":{"row":112,"column":23},"end":{"row":112,"column":24},"action":"insert","lines":["t"]}],[{"start":{"row":112,"column":48},"end":{"row":112,"column":49},"action":"remove","lines":["e"],"id":20},{"start":{"row":112,"column":47},"end":{"row":112,"column":48},"action":"remove","lines":["m"]},{"start":{"row":112,"column":46},"end":{"row":112,"column":47},"action":"remove","lines":["a"]},{"start":{"row":112,"column":45},"end":{"row":112,"column":46},"action":"remove","lines":["n"]}],[{"start":{"row":112,"column":45},"end":{"row":112,"column":46},"action":"insert","lines":["t"],"id":21},{"start":{"row":112,"column":46},"end":{"row":112,"column":47},"action":"insert","lines":["e"]},{"start":{"row":112,"column":47},"end":{"row":112,"column":48},"action":"insert","lines":["x"]},{"start":{"row":112,"column":48},"end":{"row":112,"column":49},"action":"insert","lines":["t"]}],[{"start":{"row":113,"column":8},"end":{"row":113,"column":11},"action":"insert","lines":["// "],"id":22},{"start":{"row":114,"column":8},"end":{"row":114,"column":11},"action":"insert","lines":["// "]},{"start":{"row":115,"column":8},"end":{"row":115,"column":11},"action":"insert","lines":["// "]}],[{"start":{"row":6,"column":14},"end":{"row":7,"column":0},"action":"insert","lines":["",""],"id":23}],[{"start":{"row":7,"column":0},"end":{"row":7,"column":9},"action":"insert","lines":["use Auth;"],"id":24}],[{"start":{"row":56,"column":25},"end":{"row":57,"column":0},"action":"insert","lines":["",""],"id":25},{"start":{"row":57,"column":0},"end":{"row":57,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":57,"column":8},"end":{"row":57,"column":40},"action":"insert","lines":["$book->user_id    =  Auth::id();"],"id":26}],[{"start":{"row":85,"column":8},"end":{"row":86,"column":0},"action":"insert","lines":["",""],"id":27},{"start":{"row":86,"column":0},"end":{"row":86,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":85,"column":8},"end":{"row":85,"column":42},"action":"insert","lines":["if($book->user_id === Auth::id()){"],"id":28}],[{"start":{"row":86,"column":8},"end":{"row":86,"column":12},"action":"insert","lines":["    "],"id":29}],[{"start":{"row":86,"column":56},"end":{"row":87,"column":0},"action":"insert","lines":["",""],"id":30},{"start":{"row":87,"column":0},"end":{"row":87,"column":12},"action":"insert","lines":["            "]}],[{"start":{"row":87,"column":8},"end":{"row":87,"column":12},"action":"remove","lines":["    "],"id":31}],[{"start":{"row":87,"column":8},"end":{"row":89,"column":5},"action":"insert","lines":["} else {","        return \"アクセス権がありません\";","    }"],"id":32}],[{"start":{"row":89,"column":4},"end":{"row":89,"column":8},"action":"insert","lines":["    "],"id":33}],[{"start":{"row":117,"column":8},"end":{"row":117,"column":41},"action":"remove","lines":["$book = Book::find($request->id);"],"id":34}],[{"start":{"row":117,"column":8},"end":{"row":117,"column":71},"action":"insert","lines":["$book = Book::where('user_id', Auth::id())->find($request->id);"],"id":35}],[{"start":{"row":136,"column":5},"end":{"row":137,"column":0},"action":"insert","lines":["",""],"id":36},{"start":{"row":137,"column":0},"end":{"row":137,"column":4},"action":"insert","lines":["    "]},{"start":{"row":137,"column":4},"end":{"row":138,"column":0},"action":"insert","lines":["",""]},{"start":{"row":138,"column":0},"end":{"row":138,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":138,"column":4},"end":{"row":149,"column":1},"action":"insert","lines":["// お気に入り（多対多）","public function likeBook(Book $book)","{","\t\t$book->favoriteBook()->attach(Auth::id());","\t\treturn back();","}","","public function unlikeBook(Book $book)","{","    $book->favoriteBook()->detach(Auth::id());","    return back();","}"],"id":37}],[{"start":{"row":139,"column":0},"end":{"row":139,"column":4},"action":"insert","lines":["    "],"id":38},{"start":{"row":140,"column":0},"end":{"row":140,"column":4},"action":"insert","lines":["    "]},{"start":{"row":141,"column":0},"end":{"row":141,"column":4},"action":"insert","lines":["    "]},{"start":{"row":142,"column":0},"end":{"row":142,"column":4},"action":"insert","lines":["    "]},{"start":{"row":143,"column":0},"end":{"row":143,"column":4},"action":"insert","lines":["    "]},{"start":{"row":144,"column":0},"end":{"row":144,"column":4},"action":"insert","lines":["    "]},{"start":{"row":145,"column":0},"end":{"row":145,"column":4},"action":"insert","lines":["    "]},{"start":{"row":146,"column":0},"end":{"row":146,"column":4},"action":"insert","lines":["    "]},{"start":{"row":147,"column":0},"end":{"row":147,"column":4},"action":"insert","lines":["    "]},{"start":{"row":148,"column":0},"end":{"row":148,"column":4},"action":"insert","lines":["    "]},{"start":{"row":149,"column":0},"end":{"row":149,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":5,"column":20},"end":{"row":6,"column":0},"action":"insert","lines":["",""],"id":39}],[{"start":{"row":6,"column":0},"end":{"row":6,"column":20},"action":"insert","lines":["use App\\Models\\User;"],"id":40}],[{"start":{"row":150,"column":5},"end":{"row":151,"column":0},"action":"insert","lines":["",""],"id":42},{"start":{"row":151,"column":0},"end":{"row":151,"column":4},"action":"insert","lines":["    "]},{"start":{"row":151,"column":4},"end":{"row":152,"column":0},"action":"insert","lines":["",""]},{"start":{"row":152,"column":0},"end":{"row":152,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":152,"column":4},"end":{"row":158,"column":2},"action":"insert","lines":["// 管理者ページ ※便宜的にBookコントローラーに作成","\tpublic function adminIndex()","\t{","\t\t// 1対多の複数の例","\t\t$users = User::with('books')->get();","\t\treturn view('admin', ['users' => $users]);","\t}"],"id":43}]]},"ace":{"folds":[],"scrolltop":2055,"scrollleft":0,"selection":{"start":{"row":158,"column":2},"end":{"row":158,"column":2},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":45,"state":"php-start","mode":"ace/mode/php"}},"timestamp":1648394727182,"hash":"4a9126470d9c8a0985444579b59c23fc22095219"}